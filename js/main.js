!function(){var a={},b=[],c=[],d=new Image,e=new Image,f=new Image,g=[new Image,new Image],h=[],i=16,j=0,k=document.getElementById("game"),l=document.createElement("canvas"),m=l.getContext("2d"),n=6,o=30,p=window.innerWidth,q=window.innerHeight,r=0,s=1e3/30,t=Math.floor(q/n),u=0,v=0,w=1,x=15,y=new Date,z=new Date,A=1e3,B=0,C=0,D=[],E=[],F=[],G=[],H=function(a,b,c,d){return c<a+t&&c>a&&d<b+t&&d>=b},I=function(){$.getJSON("https://tismas.github.io/data/heroes.json",function(b){$.each(b,function(b,c){a[b]=c}),M(),J()}).fail(function(){console.log("Failed to load json")})},J=function(){d.onload=M,d.src="assets/bgTile1.png";for(var i=0;i<3;i++)b.push(new Image),b[i].onload=M,b[i].src="assets/"+(i+1)+".png";for(var i=3;i<6;i++)b.push(new Image),b[i].onload=M,b[i].src="assets/fightstance"+(i-2)+".png";a.knight.image=b;for(var i=0;i<3;i++)c.push(new Image),c[i].onload=M,c[i].src="assets/sword_position"+(i+1)+".png";a.knight.weapon=c,g[0].onload=M,g[0].src="assets/anvil.png",g[1].onload=M,g[1].src="assets/anvil2.png",e.onload=M,e.src="assets/hp.png",f.onload=M,f.src="assets/moneta1.png";for(var i=0;i<4;i++)h.push(new Image),h[i].onload=M,h[i].src="assets/boss"+(i+1)+".png";K()},K=function(){l.width=p,l.height=q,k.appendChild(l),F.push(new Q(0*t,0,a.knight,L)),window.onresize=N,X(),Y()};I();var L=function(b,c){this.x=b,this.y=c,this.hp=a.knight.hp,this.maxhp=a.knight.hp,this.dmg=a.knight.dmg,this.speed=a.knight.speed,this.reward=a.knight.reward,this.attackCooldown=20,this.timeToAttack=0,this.image=a.knight.image,this.weapon=a.knight.weapon,this.moving=!0,this.attacking=!1,this.swordFrame=0,this.frame=0,this.frameTime=5,this.frameCnt=0,this.frames=3,this.attack=function(a){0==this.timeToAttack&&this.hp>0&&0==a.attacking&&(this.timeToAttack=this.attackCooldown,this.prepareNextAttack(),this.attacking=!0,setTimeout(this.strike.bind(this,a),200))},this.strike=function(a){this.hp>0&&(this.swordFrame=2,this.frame=5,a.hp-=this.dmg,a.hp<=0&&E.indexOf(a)!=-1&&(A+=a.reward),setTimeout(this.prepareNextAttack.bind(this),100))},this.prepareNextAttack=function(){this.frame=4,this.swordFrame=1,this.attacking=!1},this.die=function(){var a=D.indexOf(this);a!=-1?D.splice(a,1):(a=E.indexOf(this),E.splice(a,1)),delete this},this.draw=function(){var a=m.createLinearGradient(this.x-r,this.y,this.x-r,this.y+20);a.addColorStop(.01,"black"),a.addColorStop(.5,"rgb("+(this.maxhp-this.hp)/this.maxhp*255+","+this.hp/this.maxhp*255+",50)"),a.addColorStop(.99,"black"),m.fillStyle=a,E.indexOf(this)!=-1?(m.save(),m.translate(this.x,this.y),m.scale(-1,1),m.translate(this.x,-this.y),this.moving?(this.frame>=3&&(this.frame=1),m.drawImage(this.weapon[0],-(this.x-r),this.y,t,t)):2==this.swordFrame?m.drawImage(this.weapon[this.swordFrame],-(this.x-r-t/5),this.y,t,t):m.drawImage(this.weapon[this.swordFrame],-(this.x-r),this.y,t,t),m.drawImage(this.image[this.frame],-(this.x-r),this.y,t,t),m.fillRect(-(this.x-r-t/8),this.y,this.hp/this.maxhp*(.75*t),t/8),m.drawImage(e,-(this.x-r-t/8),this.y,.75*t,t/8),m.restore()):(this.moving?(this.frame>=3&&(this.frame=1),m.drawImage(this.weapon[0],this.x-r,this.y,t,t)):2==this.swordFrame?m.drawImage(this.weapon[this.swordFrame],this.x-r+t/5,this.y,t,t):m.drawImage(this.weapon[this.swordFrame],this.x-r,this.y,t,t),m.drawImage(this.image[this.frame],this.x-r,this.y,t,t),m.fillRect(-r+this.x+t/8,this.y,this.hp/this.maxhp*(.75*t),t/8),m.drawImage(e,-r+this.x+t/8,this.y,.75*t,t/8)),m.fillStyle="#0f0"},this.update=function(){0!=this.timeToAttack&&this.timeToAttack--,(this.hp<=0||this.x>=o*t||this.x<0)&&this.die(),this.moving||1!=this.frame&&2!=this.frame?this.moving&&(this.frameCnt++,this.frameCnt>=this.frameTime&&(this.frame++,this.frameCnt=0,this.frame>=this.frames&&(this.frame=1))):this.frame=0}},M=function(){j++,console.log("Files loaded: "+j+"/"+i)},N=function(){var a=window.innerWidth/p,b=window.innerHeight/q;p=window.innerWidth,q=window.innerHeight,l.width=p,l.height=q,t=Math.floor(q/n);for(var c=0;c<F.length;c++)F[c].x=c*t;for(var c=0;c<D.length;c++)D[c].x*=a,D[c].y*=b;for(var c=0;c<E.length;c++)E[c].x*=a,E[c].y*=b;r*=a,r>o*t-p&&(r=o*t-p),X(),Y()};l.onmousemove=function(a){u=a.x,v=a.y};var O=function(){B=0};l.onclick=function(a){a.x<=t&&a.y>=t&&(w=Math.floor(v/t),w>=n&&(w=heighT-1));for(var b=0;b<F.length;b++)F[b].collide(a.x,a.y)&&A>=F[b].cost?F[b].success():F[b].collide(a.x,a.y)&&F[b].fail();a.x>=C&&a.x<=C+t&&a.y>=0&&a.y<=t&&(B=1,A++,G.push(new P(C+t/3+(-t/8+Math.random()*(t/4)),t/2)),setTimeout(O,125))};var P=function(a,b){this.x=a,this.y=b,this.draw=function(){m.fillStyle="rgba(255,255,255,"+this.y/b+")",m.fillText("+1",this.x,this.y)},this.update=function(){this.y--,this.y<=0&&(G.splice(G.indexOf(this),1),delete this)}},Q=function(a,b,c,d,e,f){this.x=a,this.y=b,this.color=c.color,this.cost=c.price,this.background=e||"#333",this.hover=f||"#555",this.failed=!1,this.succeed=!1,this.statusCounter=0,this.fail=function(){this.failed=!0,this.statusCounter=5},this.success=function(){this.succeed=!0,A-=this.cost,this.statusCounter=5,D.push(new d(0,w*t))},this.collide=function(a,b){return H(this.x,this.y,a,b)},this.draw=function(){this.failed?m.fillStyle="#500":this.succeed?m.fillStyle="#050":H(a,b,u,v)?m.fillStyle=this.hover:m.fillStyle=this.background,m.fillRect(this.x,this.y,t,t);var d=t-2*t/5;m.drawImage(c.weapon[0],this.x+t/5,this.y+t/10,d,d),m.drawImage(c.image[0],this.x+t/5,this.y+t/10,d,d),m.fillStyle="#fff",m.font="20px Arial";var e="$"+this.cost;m.fillText(e,this.x+t-t/2-m.measureText(e).width/2,this.y+t-15),this.statusCounter>0?this.statusCounter--:(this.failed||this.succeed)&&(this.failed=!1,this.succeed=!1)}},R=function(){m.fillStyle="#fff",m.fillRect(0,0,p,1),m.fillRect(0,0,2,t),m.fillRect(0,t,p,1),m.fillRect(p-1,0,1,t);var a=Math.round(p/2/t)-1;m.fillRect(t*a,0,1,t),m.fillRect(t*(a+1),0,1,t)},S=function(){for(var a=0;a<G.length;a++)G[a].update()},T=function(){m.fillStyle="#000",m.fillRect(0,0,t*o,t);for(var a=0;a<F.length;a++)F[a].draw();m.font="20px Arial",m.fillStyle="#fff";var b=Math.round(p/2/t)-1;m.drawImage(f,t*b+10,t/6,t/5,t/5),m.fillText(A,t*b+t/5+10,t/6+20),C=t*(b+1),m.drawImage(g[B],C,0,t,t);for(var a=0;a<G.length;a++)G[a].draw();R()},U=function(){u<=t&&r>0?r-=x:u>=p-t&&r<o*t-p&&(r+=x)},V=function(){for(var a=0;a<D.length;a++){for(var b=!0,c=null,d=0;d<D.length;d++)if(a!=d&&H(D[a].x,D[a].y,D[d].x,D[d].y)&&D[a].x<D[d].x){b=!1,D[a].moving=!1;break}for(var d=0;d<E.length;d++)if(H(D[a].x,D[a].y,E[d].x-t,E[d].y)){b=!1,D[a].moving=!1,c=E[d];break}b?(D[a].x+=D[a].speed,D[a].moving=!0):null!=c&&(0==D[a].swordFrame&&(D[a].swordFrame=1),D[a].frame<=3&&(D[a].frame=4),D[a].attack(c)),D[a].update()}},W=function(){for(var a=0;a<E.length;a++){for(var b=!0,c=null,d=0;d<E.length;d++)if(a!=d&&H(E[d].x,E[d].y,E[a].x,E[a].y)&&E[a].x>E[d].x){b=!1,E[a].moving=!1;break}for(var d=0;d<D.length;d++)if(H(D[d].x,D[d].y,E[a].x-t,E[a].y)){b=!1,E[a].moving=!1,c=D[d];break}b?(E[a].x-=E[a].speed,E[a].moving=!0):null!=c&&(0==E[a].swordFrame&&(E[a].swordFrame=1),E[a].frame<=3&&(E[a].frame=4),E[a].attack(c)),E[a].update()}},X=function(){y=new Date;var a=y-z;if(a>s){for(U();a>s;){var b=Math.floor(100*Math.random());1==b&&E.push(new L(o*t,t*(Math.floor(5*Math.random())+1))),V(),W(),S(),a-=s}z=y}requestAnimationFrame(Y)},Y=function(){m.fillStyle="#000",m.fillRect(0,0,l.width,l.height);for(var a=Math.floor(r/t),b=Math.floor(p/t),c=a;c<=a+b+1;c++)for(var e=0;e<n;e++)m.drawImage(d,c*t-r,e*t,t,t);var f=m.createLinearGradient(-r-t/8,0,t,0);f.addColorStop(0,"yellow"),f.addColorStop(.5,"transparent");var g=m.createLinearGradient(-r-t/8,0,t,0);if(g.addColorStop(0,"blue"),g.addColorStop(.5,"transparent"),m.fillStyle=f,m.fillRect(-r,t*w,t,t),u<=t&&v>=t){var h=Math.floor(v/t);h<n&&h!=w&&(m.fillStyle=g,m.fillRect(-r,h*t,t,t))}for(var c=0;c<D.length;c++)D[c].draw();for(var c=0;c<E.length;c++)E[c].draw();T(),setTimeout(X,s)}}();