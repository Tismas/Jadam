!function(){var a={},b=[],c=[],d=new Image,e=new Image,f=new Image,g=[new Image,new Image],h=[],i=22,j=0;game=document.getElementById("game"),canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),imageCount=0,heightT=6,widthT=30,width=window.innerWidth,height=window.innerHeight,offset=0,interval=1e3/30,tileSize=Math.floor(height/heightT),mouseX=0,mouseY=0,activeRow=1,scrollSpeed=15,now=new Date,before=new Date,money=1e3,isAnvilClicked=0,anvilX=0,playerUnits=[],enemyUnits=[],unitButtons=[],particles=[],bossHp=100;var k=function(a,b,c,d){return c<a+tileSize&&c>a&&d<b+tileSize&&d>=b},l=function(a,b){return(a.x+tileSize>=b.x&&b.x>a.x||a.x-tileSize<=b.x&&a.x>b.x)&&a.y==b.y},m=function(){$.getJSON("https://tismas.github.io/data/heroes.json",function(b){$.each(b,function(b,c){a[b]=c}),q(),n()}).fail(function(){console.log("Failed to load json")})},n=function(){d.onload=q,d.src="assets/bgTile1.png";for(var i=0;i<6;i++)b.push(new Image),b[i].onload=q,b[i].src="assets/stevo"+(i+1)+".png";a.knight.image=b;for(var i=0;i<6;i++)c.push(new Image),c[i].onload=q,c[i].src="assets/sword_position"+(i+1)+".png";a.knight.weapon=c,g[0].onload=q,g[0].src="assets/anvil.png",g[1].onload=q,g[1].src="assets/anvil2.png",e.onload=q,e.src="assets/hp.png",f.onload=q,f.src="assets/moneta1.png";for(var i=0;i<4;i++)h.push(new Image),h[i].onload=q,h[i].src="assets/boss"+(i+1)+".png";o()},o=function(){canvas.width=width,canvas.height=height,game.appendChild(canvas),unitButtons.push(new u(0*tileSize,0,a.knight,p)),window.onresize=r,B(),C()};m();var p=function(b,c,d){this.x=b,this.y=c,this.tileY=c/tileSize,this.hp=a.knight.hp,this.maxhp=a.knight.hp,this.dmg=a.knight.dmg,this.speed=.04,this.reward=a.knight.reward,this.rangeAspect=.75,this.range=tileSize*this.rangeAspect,this.attackCooldown=20,this.timeToAttack=0,this.image=a.knight.image,this.weapon=a.knight.weapon,this.moving=!0,this.attacking=!1,this.frame=0,this.frameTime=5,this.frameCnt=0,this.frames=3,this.flipped=d||!1};p.prototype={getTarget:function(){if(this.flipped)for(var a=0,b=playerUnits.length;a<b;a++){var c=playerUnits[a];if(c&&c.x>=this.x-this.range&&c.y==this.y)return c}else for(var a=0,d=enemyUnits.length;a<d;a++){var e=enemyUnits[a];if(e&&e.x<=this.x+this.range&&e.y==this.y)return e}return null},attack:function(a){0==this.timeToAttack&&this.hp>0&&0==a.attacking&&(this.timeToAttack=this.attackCooldown,this.prepareNextAttack(),this.attacking=!0,setTimeout(this.strike.bind(this,a),200))},strike:function(a){this.hp>0&&(this.swordFrame=2,this.frame=5,a.hp-=this.dmg,a.hp<=0&&enemyUnits.indexOf(a)!=-1&&(money+=a.reward),setTimeout(this.prepareNextAttack.bind(this),125))},prepareNextAttack:function(){this.frame=4,this.swordFrame=1,this.attacking=!1},die:function(){var a=playerUnits.indexOf(this);a!=-1?playerUnits.splice(a,1):(a=enemyUnits.indexOf(this),enemyUnits.splice(a,1)),delete this},draw:function(){var a=ctx.createLinearGradient(this.x-offset,this.y,this.x-offset,this.y+20);if(a.addColorStop(.01,"black"),a.addColorStop(.5,"rgb("+(this.maxhp-this.hp)/this.maxhp*255+","+this.hp/this.maxhp*255+",50)"),a.addColorStop(.99,"black"),ctx.fillStyle=a,this.hp<0&&(this.hp=0),this.flipped){ctx.save(),ctx.translate(this.x,this.y),ctx.scale(-1,1),ctx.translate(this.x-tileSize,-this.y);var b=-(this.x-offset);6==this.swordFrame?ctx.drawImage(this.weapon[this.frame],b+tileSize/5,this.y,tileSize,tileSize):ctx.drawImage(this.weapon[this.frame],b,this.y,tileSize,tileSize),ctx.drawImage(this.image[this.frame],b,this.y,tileSize,tileSize),ctx.restore()}else 6==this.swordFrame?ctx.drawImage(this.weapon[this.frame],this.x-offset+tileSize/5,this.y,tileSize,tileSize):ctx.drawImage(this.weapon[this.frame],this.x-offset,this.y,tileSize,tileSize),ctx.drawImage(this.image[this.frame],this.x-offset,this.y,tileSize,tileSize);ctx.fillRect(this.x-offset+tileSize/8,this.y,this.hp/this.maxhp*(.75*tileSize),tileSize/8),ctx.drawImage(e,this.x-offset+tileSize/8,this.y,.75*tileSize,tileSize/8),ctx.fillStyle="#0f0"},update:function(){var a,b=!0,c=this.getTarget();if(this.flipped){for(var d=0,e=enemyUnits.length;d<e;d++)if(a=enemyUnits[d],a&&this!==a&&l(a,this)&&this.x>a.x){b=!1,this.moving=!1;break}c&&(b=!1,this.moving=!1,this.frame<=3&&(this.frame=4),this.attack(c)),b&&(this.x-=this.speed*tileSize,this.moving=!0)}else{for(var d=0,f=playerUnits.length;d<f;d++)if(a=playerUnits[d],a&&this!==a&&l(this,a)&&this.x<a.x){b=!1,this.moving=!1;break}c&&(b=!1,this.moving=!1,this.frame<=3&&(this.frame=4),this.attack(c)),b&&(this.x+=this.speed*tileSize,this.moving=!0)}this.updateAnimation()},updateAnimation:function(){0!=this.timeToAttack&&this.timeToAttack--,(this.hp<=0||this.x>=widthT*tileSize||this.x<0)&&this.die(),this.moving||1!=this.frame&&2!=this.frame?this.moving&&(this.frameCnt++,this.frameCnt>=this.frameTime&&(this.frame++,this.frameCnt=0,this.frame>=this.frames&&(this.frame=1))):this.frame=0}};var q=function(){j++,console.log("Files loaded: "+j+"/"+i)},r=function(){var a=window.innerWidth/width;window.innerHeight/height;width=window.innerWidth,height=window.innerHeight,canvas.width=width,canvas.height=height,tileSize=Math.floor(height/heightT);for(var b=0,c=unitButtons.length;b<c;b++)unitButtons[b].x=b*tileSize;for(var b=0,d=playerUnits.length;b<d;b++)playerUnits[b]&&(playerUnits[b].x*=a,playerUnits[b].y=playerUnits[b].tileY*tileSize,playerUnits[b].range=playerUnits[b].rangeAspect*tileSize);for(var b=0,e=enemyUnits.length;b<e;b++)enemyUnits[b]&&(enemyUnits[b].x*=a,enemyUnits[b].y=enemyUnits[b].tileY*tileSize,enemyUnits[b].range=enemyUnits[b].rangeAspect*tileSize);offset>widthT*tileSize-width&&(offset=widthT*tileSize-width),B(),C()};canvas.onmousemove=function(a){mouseX=a.x,mouseY=a.y};var s=function(){isAnvilClicked=0};canvas.onclick=function(a){a.x<=tileSize&&a.y>=tileSize&&(activeRow=Math.floor(mouseY/tileSize),activeRow>=heightT&&(activeRow=heighT-1));for(var b=0;b<unitButtons.length;b++)unitButtons[b].collide(a.x,a.y)&&money>=unitButtons[b].cost?unitButtons[b].success():unitButtons[b].collide(a.x,a.y)&&unitButtons[b].fail();a.x>=anvilX&&a.x<=anvilX+tileSize&&a.y>=0&&a.y<=tileSize&&(isAnvilClicked=1,money++,particles.push(new t(anvilX+tileSize/3+(-tileSize/8+Math.random()*(tileSize/4)),tileSize/2)),setTimeout(s,125))};var t=function(a,b){this.x=a,this.y=b,this.draw=function(){ctx.fillStyle="rgba(255,255,255,"+this.y/b+")",ctx.fillText("+1",this.x,this.y)},this.update=function(){this.y--,this.y<=0&&(particles.splice(particles.indexOf(this),1),delete this)}},u=function(a,b,c,d,e,f){this.x=a,this.y=b,this.color=c.color,this.cost=c.price,this.background=e||"#333",this.hover=f||"#555",this.failed=!1,this.succeed=!1,this.statusCounter=0,this.fail=function(){this.failed=!0,this.statusCounter=5},this.success=function(){this.succeed=!0,money-=this.cost,this.statusCounter=5,playerUnits.push(new d(0,activeRow*tileSize))},this.collide=function(a,b){return k(this.x,this.y,a,b)},this.draw=function(){this.failed?ctx.fillStyle="#500":this.succeed?ctx.fillStyle="#050":k(a,b,mouseX,mouseY)?ctx.fillStyle=this.hover:ctx.fillStyle=this.background,ctx.fillRect(this.x,this.y,tileSize,tileSize);var d=tileSize-2*tileSize/5;ctx.drawImage(c.weapon[0],this.x+tileSize/5,this.y+tileSize/10,d,d),ctx.drawImage(c.image[0],this.x+tileSize/5,this.y+tileSize/10,d,d),ctx.fillStyle="#fff",ctx.font="20px Arial";var e="$"+this.cost;ctx.fillText(e,this.x+tileSize-tileSize/2-ctx.measureText(e).width/2,this.y+tileSize-15),this.statusCounter>0?this.statusCounter--:(this.failed||this.succeed)&&(this.failed=!1,this.succeed=!1)}},v=function(){ctx.fillStyle="#fff",ctx.fillRect(0,0,width,1),ctx.fillRect(0,0,2,tileSize),ctx.fillRect(0,tileSize,width,1),ctx.fillRect(width-1,0,1,tileSize);var a=Math.round(width/2/tileSize)-1;ctx.fillRect(tileSize*a,0,1,tileSize),ctx.fillRect(tileSize*(a+1),0,1,tileSize)},w=function(){for(var a=0;a<particles.length;a++)particles[a].update()},x=function(){ctx.fillStyle="#000",ctx.fillRect(0,0,tileSize*widthT,tileSize);for(var a=0;a<unitButtons.length;a++)unitButtons[a].draw();ctx.font="20px Arial",ctx.fillStyle="#fff";var b=Math.round(width/2/tileSize)-1;ctx.drawImage(f,tileSize*b+10,tileSize/6,tileSize/5,tileSize/5),ctx.fillText(money,tileSize*b+tileSize/5+10,tileSize/6+20),anvilX=tileSize*(b+1),ctx.drawImage(g[isAnvilClicked],anvilX,0,tileSize,tileSize);for(var a=0;a<particles.length;a++)particles[a].draw();v()},y=function(){mouseX<=tileSize&&offset>0?offset-=scrollSpeed:mouseX>=width-tileSize&&offset<widthT*tileSize-width&&(offset+=scrollSpeed)},z=function(){for(var a,b=0,c=playerUnits.length;b<c;b++)a=playerUnits[b],a&&a.update()},A=function(){for(var a,b=0,c=enemyUnits.length;b<c;b++)a=enemyUnits[b],a&&a.update()},B=function(){now=new Date;var a=now-before;if(a>interval){for(y();a>interval;){var b=Math.floor(500*Math.random());b<5&&enemyUnits.push(new p(widthT*tileSize,tileSize*(b+1),(!0))),z(),A(),w(),a-=interval}before=now}requestAnimationFrame(C)},C=function(){ctx.fillStyle="#000",ctx.fillRect(0,0,canvas.width,canvas.height);for(var a=Math.floor(offset/tileSize),b=Math.floor(width/tileSize),c=a;c<=a+b+1;c++)for(var e=0;e<heightT;e++)ctx.drawImage(d,c*tileSize-offset,e*tileSize,tileSize,tileSize);var f=ctx.createLinearGradient(-offset-tileSize/8,0,tileSize,0);f.addColorStop(0,"yellow"),f.addColorStop(.5,"transparent");var g=ctx.createLinearGradient(-offset-tileSize/8,0,tileSize,0);if(g.addColorStop(0,"blue"),g.addColorStop(.5,"transparent"),ctx.fillStyle=f,ctx.fillRect(-offset,tileSize*activeRow,tileSize,tileSize),mouseX<=tileSize&&mouseY>=tileSize){var h=Math.floor(mouseY/tileSize);h<heightT&&h!=activeRow&&(ctx.fillStyle=g,ctx.fillRect(-offset,h*tileSize,tileSize,tileSize))}for(var c=0,i=playerUnits.length;c<i;c++)playerUnits[c].draw();for(var c=0,j=enemyUnits.length;c<j;c++)enemyUnits[c].draw();x(),setTimeout(B,interval)}}();