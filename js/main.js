!function(){var a={},b=[],c=[],d=new Image,e=new Image,f=new Image,g=[new Image,new Image],h=[],i=16,j=0,k=document.getElementById("game"),l=document.createElement("canvas"),m=l.getContext("2d"),n=6,o=30,p=window.innerWidth,q=window.innerHeight,r=0,s=1e3/30,t=Math.floor(q/n),u=0,v=0,w=1,x=15,y=new Date,z=new Date,A=1e3,B=0,C=0,D=[],E=[],F=[],G=[],H=function(a,b,c,d){return c<a+t&&c>a&&d<b+t&&d>=b},I=function(a,b){return(a.x+t>=b.x&&b.x>a.x||a.x-t<=b.x&&a.x>b.x)&&a.y==b.y},J=function(){$.getJSON("https://tismas.github.io/data/heroes.json",function(b){$.each(b,function(b,c){a[b]=c}),N(),K()}).fail(function(){console.log("Failed to load json")})},K=function(){d.onload=N,d.src="assets/bgTile1.png";for(var i=0;i<6;i++)b.push(new Image),b[i].onload=N,b[i].src="assets/stevo"+(i+1)+".png";a.knight.image=b;for(var i=0;i<6;i++)c.push(new Image),c[i].onload=N,c[i].src="assets/sword_position"+(i+1)+".png";a.knight.weapon=c,g[0].onload=N,g[0].src="assets/anvil.png",g[1].onload=N,g[1].src="assets/anvil2.png",e.onload=N,e.src="assets/hp.png",f.onload=N,f.src="assets/moneta1.png";for(var i=0;i<4;i++)h.push(new Image),h[i].onload=N,h[i].src="assets/boss"+(i+1)+".png";L()},L=function(){l.width=p,l.height=q,k.appendChild(l),F.push(new R(0*t,0,a.knight,M)),window.onresize=O,Y(),Z()};J();var M=function(b,c,d){this.x=b,this.y=c,this.hp=a.knight.hp,this.maxhp=a.knight.hp,this.dmg=a.knight.dmg,this.speed=a.knight.speed,this.reward=a.knight.reward,this.range=.75*t,this.attackCooldown=20,this.timeToAttack=0,this.image=a.knight.image,this.weapon=a.knight.weapon,this.moving=!0,this.attacking=!1,this.frame=0,this.frameTime=5,this.frameCnt=0,this.frames=3,this.flipped=d||!1};M.prototype={getTarget:function(){if(this.flipped)for(var a=0,b=D.length;a<b;a++){var c=D[a];if(c&&c.x>=this.x-this.range&&c.y==this.y)return c}else for(var a=0,d=E.length;a<d;a++){var e=E[a];if(e&&e.x<=this.x+this.range&&e.y==this.y)return e}return null},attack:function(a){0==this.timeToAttack&&this.hp>0&&0==a.attacking&&(this.timeToAttack=this.attackCooldown,this.prepareNextAttack(),this.attacking=!0,setTimeout(this.strike.bind(this,a),200))},strike:function(a){this.hp>0&&(this.swordFrame=2,this.frame=5,a.hp-=this.dmg,a.hp<=0&&E.indexOf(a)!=-1&&(A+=a.reward),setTimeout(this.prepareNextAttack.bind(this),125))},prepareNextAttack:function(){this.frame=4,this.swordFrame=1,this.attacking=!1},die:function(){var a=D.indexOf(this);a!=-1?D.splice(a,1):(a=E.indexOf(this),E.splice(a,1)),delete this},draw:function(){var a=m.createLinearGradient(this.x-r,this.y,this.x-r,this.y+20);if(a.addColorStop(.01,"black"),a.addColorStop(.5,"rgb("+(this.maxhp-this.hp)/this.maxhp*255+","+this.hp/this.maxhp*255+",50)"),a.addColorStop(.99,"black"),m.fillStyle=a,this.hp<0&&(this.hp=0),this.flipped){m.save(),m.translate(this.x,this.y),m.scale(-1,1),m.translate(this.x-t,-this.y);var b=-(this.x-r);6==this.swordFrame?m.drawImage(this.weapon[this.frame],b+t/5,this.y,t,t):m.drawImage(this.weapon[this.frame],b,this.y,t,t),m.drawImage(this.image[this.frame],b,this.y,t,t),m.restore()}else 6==this.swordFrame?m.drawImage(this.weapon[this.frame],this.x-r+t/5,this.y,t,t):m.drawImage(this.weapon[this.frame],this.x-r,this.y,t,t),m.drawImage(this.image[this.frame],this.x-r,this.y,t,t);m.fillRect(this.x-r+t/8,this.y,this.hp/this.maxhp*(.75*t),t/8),m.drawImage(e,this.x-r+t/8,this.y,.75*t,t/8),m.fillStyle="#0f0"},update:function(){0!=this.timeToAttack&&this.timeToAttack--,(this.hp<=0||this.x>=o*t||this.x<0)&&this.die(),this.moving||1!=this.frame&&2!=this.frame?this.moving&&(this.frameCnt++,this.frameCnt>=this.frameTime&&(this.frame++,this.frameCnt=0,this.frame>=this.frames&&(this.frame=1))):this.frame=0}};var N=function(){j++,console.log("Files loaded: "+j+"/"+i)},O=function(){var a=window.innerWidth/p,b=window.innerHeight/q;p=window.innerWidth,q=window.innerHeight,l.width=p,l.height=q,t=Math.floor(q/n);for(var c=0;c<F.length;c++)F[c].x=c*t;for(var c=0;c<D.length;c++)D[c].x*=a,D[c].y*=b;for(var c=0;c<E.length;c++)E[c].x*=a,E[c].y*=b;r*=a,r>o*t-p&&(r=o*t-p),Y(),Z()};l.onmousemove=function(a){u=a.x,v=a.y};var P=function(){B=0};l.onclick=function(a){a.x<=t&&a.y>=t&&(w=Math.floor(v/t),w>=n&&(w=heighT-1));for(var b=0;b<F.length;b++)F[b].collide(a.x,a.y)&&A>=F[b].cost?F[b].success():F[b].collide(a.x,a.y)&&F[b].fail();a.x>=C&&a.x<=C+t&&a.y>=0&&a.y<=t&&(B=1,A++,G.push(new Q(C+t/3+(-t/8+Math.random()*(t/4)),t/2)),setTimeout(P,125))};var Q=function(a,b){this.x=a,this.y=b,this.draw=function(){m.fillStyle="rgba(255,255,255,"+this.y/b+")",m.fillText("+1",this.x,this.y)},this.update=function(){this.y--,this.y<=0&&(G.splice(G.indexOf(this),1),delete this)}},R=function(a,b,c,d,e,f){this.x=a,this.y=b,this.color=c.color,this.cost=c.price,this.background=e||"#333",this.hover=f||"#555",this.failed=!1,this.succeed=!1,this.statusCounter=0,this.fail=function(){this.failed=!0,this.statusCounter=5},this.success=function(){this.succeed=!0,A-=this.cost,this.statusCounter=5,D.push(new d(0,w*t))},this.collide=function(a,b){return H(this.x,this.y,a,b)},this.draw=function(){this.failed?m.fillStyle="#500":this.succeed?m.fillStyle="#050":H(a,b,u,v)?m.fillStyle=this.hover:m.fillStyle=this.background,m.fillRect(this.x,this.y,t,t);var d=t-2*t/5;m.drawImage(c.weapon[0],this.x+t/5,this.y+t/10,d,d),m.drawImage(c.image[0],this.x+t/5,this.y+t/10,d,d),m.fillStyle="#fff",m.font="20px Arial";var e="$"+this.cost;m.fillText(e,this.x+t-t/2-m.measureText(e).width/2,this.y+t-15),this.statusCounter>0?this.statusCounter--:(this.failed||this.succeed)&&(this.failed=!1,this.succeed=!1)}},S=function(){m.fillStyle="#fff",m.fillRect(0,0,p,1),m.fillRect(0,0,2,t),m.fillRect(0,t,p,1),m.fillRect(p-1,0,1,t);var a=Math.round(p/2/t)-1;m.fillRect(t*a,0,1,t),m.fillRect(t*(a+1),0,1,t)},T=function(){for(var a=0;a<G.length;a++)G[a].update()},U=function(){m.fillStyle="#000",m.fillRect(0,0,t*o,t);for(var a=0;a<F.length;a++)F[a].draw();m.font="20px Arial",m.fillStyle="#fff";var b=Math.round(p/2/t)-1;m.drawImage(f,t*b+10,t/6,t/5,t/5),m.fillText(A,t*b+t/5+10,t/6+20),C=t*(b+1),m.drawImage(g[B],C,0,t,t);for(var a=0;a<G.length;a++)G[a].draw();S()},V=function(){u<=t&&r>0?r-=x:u>=p-t&&r<o*t-p&&(r+=x)},W=function(){var a=0,b=D.length;for(E.length;a<b;a++){var c=D[a];if(c){for(var d=!0,e=c.getTarget(),f=0;f<b;f++)if(D[f]&&a!=f&&I(c,D[f])&&c.x<D[f].x){d=!1,c.moving=!1;break}e&&(d=!1,c.moving=!1,c.frame<=3&&(c.frame=4),c.attack(e)),d&&(c.x+=c.speed,c.moving=!0),c.update()}}},X=function(){var a=0,b=E.length;for(D.length;a<b;a++){var c=E[a];if(c){for(var d=!0,e=c.getTarget(),f=0;f<b;f++){var g=E[f];if(g&&a!=f&&I(g,c)&&c.x>g.x){d=!1,c.moving=!1;break}}e&&(d=!1,c.moving=!1,c.frame<=3&&(c.frame=4),c.attack(e)),d&&(c.x-=c.speed,c.moving=!0),c.update()}}},Y=function(){y=new Date;var a=y-z;if(a>s){for(V();a>s;){var b=Math.floor(500*Math.random());b<5&&E.push(new M(o*t,t*(b+1),(!0))),W(),X(),T(),a-=s}z=y}requestAnimationFrame(Z)},Z=function(){m.fillStyle="#000",m.fillRect(0,0,l.width,l.height);for(var a=Math.floor(r/t),b=Math.floor(p/t),c=a;c<=a+b+1;c++)for(var e=0;e<n;e++)m.drawImage(d,c*t-r,e*t,t,t);var f=m.createLinearGradient(-r-t/8,0,t,0);f.addColorStop(0,"yellow"),f.addColorStop(.5,"transparent");var g=m.createLinearGradient(-r-t/8,0,t,0);if(g.addColorStop(0,"blue"),g.addColorStop(.5,"transparent"),m.fillStyle=f,m.fillRect(-r,t*w,t,t),u<=t&&v>=t){var h=Math.floor(v/t);h<n&&h!=w&&(m.fillStyle=g,m.fillRect(-r,h*t,t,t))}for(var c=0,i=D.length;c<i;c++)D[c].draw();for(var c=0,j=E.length;c<j;c++)E[c].draw();U(),setTimeout(Y,s)}}();