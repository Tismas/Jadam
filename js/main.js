!function(){var a,b=7,c=0,d=document.getElementById("game"),e=document.createElement("canvas"),f=e.getContext("2d"),g=7,h=30,i=window.innerWidth,j=window.innerHeight,k=0,l=1e3/30,m=Math.floor(j/g),n=0,o=0,p=1,q=15,r=new Date,s=new Date,t=100,u=[],v=[],w=[],x=function(a,b,c,d){return c<a+m&&c>a&&d<b+m&&d>=b},y=function(b,c){this.x=b,this.y=c,this.hp=a.knight.hp,this.maxhp=a.knight.hp,this.dmg=a.knight.dmg,this.speed=a.knight.speed,this.reward=a.knight.reward,this.attackCooldown=20,this.timeToAttack=0,this.image=a.knight.image,this.moving=!0,this.frame=0,this.frameTime=5,this.frameCnt=0,this.frames=3,this.attack=function(a){0==this.timeToAttack&&this.hp>0&&(this.timeToAttack=this.attackCooldown,a.hp-=this.dmg,a.hp<=0&&v.indexOf(a)!=-1&&(t+=a.reward))},this.die=function(){var a=u.indexOf(this);a!=-1?u.splice(a,1):(a=v.indexOf(this),v.splice(a,1))},this.draw=function(){var a=f.createLinearGradient(this.x-k,this.y,this.x-k,this.y+20);a.addColorStop(.01,"black"),a.addColorStop(.5,"rgb("+(this.maxhp-this.hp)/this.maxhp*255+","+this.hp/this.maxhp*255+",50)"),a.addColorStop(.99,"black"),f.fillStyle=a,v.indexOf(this)!=-1?(f.save(),f.translate(this.x,this.y),f.scale(-1,1),f.translate(this.x,-this.y),f.drawImage(this.image[this.frame],-(this.x-k+m/4),this.y+m/4,m,m),f.fillRect(-(this.x-k)-m/5,this.y,this.hp/this.maxhp*(.75*m),20),f.drawImage(hpBorder,-(this.x-k)-m/5,this.y,.75*m,20),f.restore()):(f.drawImage(this.image[this.frame],this.x-k+m/4,this.y+m/4,m,m),f.fillRect(-k+this.x+m/3,this.y,this.hp/this.maxhp*(.75*m),20),f.drawImage(hpBorder,-k+this.x+m/3,this.y,.75*m,20)),f.fillStyle="#0f0"},this.update=function(){0!=this.timeToAttack&&this.timeToAttack--,(this.hp<=0||this.x>=h*m||this.x<0)&&this.die(),this.moving?(this.frameCnt++,this.frameCnt>=this.frameTime&&(this.frame++,this.frameCnt=0,this.frame==this.frames&&(this.frame=1))):this.frame=0}},z=function(){c++,console.log("Files loaded: "+c+"/"+b)},A=function(){i=window.innerWidth,j=window.innerHeight,e.width=i,e.height=j;var a=m;m=Math.floor(j/g);for(var b=0;b<w.length;b++)w[b].x=b*m;for(var b=0;b<u.length;b++){var c=u[b].x/a;u[b].x=c*m}for(var b=0;b<v.length;b++){var c=v[b].x/a;v[b].x=c*m}F(),I()};e.onmousemove=function(a){n=a.x,o=a.y},e.onclick=function(a){a.x<=m&&a.y>=m&&(p=Math.floor(o/m),p>=g&&(p=heighT-1));for(var b=0;b<w.length;b++)w[b].collide(a.x,a.y)&&t>=w[b].cost?w[b].success():w[b].collide(a.x,a.y)&&w[b].fail()};var B=function(a,b,c,d,e,g){this.x=a,this.y=b,this.color=c.color,this.cost=c.price,this.background=e||"#333",this.hover=g||"#555",this.failed=!1,this.succeed=!1,this.statusCounter=0,this.fail=function(){this.failed=!0,this.statusCounter=5},this.success=function(){this.succeed=!0,t-=this.cost,this.statusCounter=5,u.push(new d(0,p*m))},this.collide=function(a,b){return x(this.x,this.y,a,b)},this.draw=function(){this.failed?f.fillStyle="#500":this.succeed?f.fillStyle="#050":x(a,b,n,o)?f.fillStyle=this.hover:f.fillStyle=this.background,f.fillRect(this.x,this.y,m,m),f.drawImage(c.image[0],this.x+m/5,this.y+m/10,m-2*m/5,m-2*m/5),f.fillStyle="#fff",f.font="20px Arial";var d="$"+this.cost;f.fillText(d,this.x+m-m/2-f.measureText(d).width/2,this.y+m-15),this.statusCounter>0?this.statusCounter--:(this.failed||this.succeed)&&(this.failed=!1,this.succeed=!1)}},C=function(){n<=m&&k>0?k-=q:n>=i-m&&k<h*m-i&&(k+=q)},D=function(){for(var a=0;a<u.length;a++){for(var b=!0,c=null,d=0;d<u.length;d++)if(a!=d&&x(u[a].x,u[a].y,u[d].x,u[d].y)&&u[a].x<u[d].x){b=!1,u[a].moving=!1;break}for(var d=0;d<v.length;d++)if(x(u[a].x,u[a].y,v[d].x-m,v[d].y)){b=!1,u[a].moving=!1,c=v[d];break}b?(u[a].x+=u[a].speed,u[a].moving=!0):null!=c&&u[a].attack(c),u[a].update()}},E=function(){for(var a=0;a<v.length;a++){for(var b=!0,c=null,d=0;d<v.length;d++)if(a!=d&&x(v[d].x,v[d].y,v[a].x,v[a].y)&&v[a].x>v[d].x){b=!1,v[a].moving=!1;break}for(var d=0;d<u.length;d++)if(x(u[d].x,u[d].y,v[a].x-m,v[a].y)){b=!1,v[a].moving=!1,c=u[d];break}b?(v[a].x-=v[a].speed,v[a].moving=!0):null!=c&&v[a].attack(c),v[a].update()}},F=function(){r=new Date;var a=r-s;if(a>l){for(C();a>l;){var b=Math.floor(300*Math.random());1==b&&v.push(new y(h*m,m*(Math.floor(5*Math.random())+1))),D(),E(),a-=l}s=r}requestAnimationFrame(I)},G=function(){f.fillStyle="#fff",f.fillRect(0,0,i,1),f.fillRect(0,0,2,m),f.fillRect(0,m,i,1),f.fillRect(i-1,0,1,m);var a=Math.round(i/2/m)-1;f.fillRect(m*a,0,1,m),f.fillRect(m*(a+1),0,1,m)},H=function(){f.fillStyle="#000",f.fillRect(0,0,m*h,m);for(var a=0;a<w.length;a++)w[a].draw();f.font="20px Arial",f.fillStyle="#fff";var b=Math.round(i/2/m)-1;f.drawImage(coin,m*b+10,m/6,m/5,m/5),f.fillText(t,m*b+m/5+10,m/6+20),G()},I=function(){f.fillStyle="#000",f.fillRect(0,0,e.width,e.height),f.drawImage(bg,-k,m,h*m,j-m);var a=f.createLinearGradient(-k-m/8,0,m,0);a.addColorStop(0,"yellow"),a.addColorStop(.5,"transparent");var b=f.createLinearGradient(-k-m/8,0,m,0);if(b.addColorStop(0,"blue"),b.addColorStop(.5,"transparent"),f.fillStyle=a,f.fillRect(-k,m*p,m,m),n<=m&&o>=m){var c=Math.floor(o/m);c<g&&c!=p&&(f.fillStyle=b,f.fillRect(-k,c*m,m,m))}for(var d=0;d<u.length;d++)u[d].draw();for(var d=0;d<v.length;d++)v[d].draw();H(),setTimeout(F,l)},J=function(){var b=new Image;b.onload=z,b.src="assets/background.png";for(var c=[],d=0;d<3;d++)c.push(new Image),c[d].onload=z,c[d].src="assets/"+(d+1)+".png";a.knight.image=c;var e=new Image;e.onload=z,e.src="assets/hp.png";var f=new Image;f.onload=z,f.src="assets/moneta1.png",$.ajax({dataType:"json",url:"data/heroes.json",data:a,success:z()}),console.log(a)},K=function(){J(),e.width=i,e.height=j,d.appendChild(e),w.push(new B(0*m,0,a.knight,y)),window.onresize=A,F(),I()};K()}();